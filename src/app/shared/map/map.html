<div class="map-page">

  <!-- Header -->
  <div class="map-header">
    <div>
      <h1 class="map-title">Office Locations</h1>
      <p class="map-subtitle">{{ stats.total }} locations across {{ stats.countries }} countries</p>
    </div>
    <button class="map-reset-btn" (click)="resetView()">
      <i class="bi bi-arrows-fullscreen"></i> Reset View
    </button>
  </div>

  <!-- Stats -->
  <div class="map-stats">
    <div class="map-stat-card">
      <div class="map-stat-icon" style="background:rgba(79,110,247,0.12)">
        <i class="bi bi-building" style="color:#4F6EF7"></i>
      </div>
      <div>
        <p class="map-stat-val">{{ stats.total }}</p>
        <p class="map-stat-lbl">Total Locations</p>
      </div>
    </div>
    <div class="map-stat-card">
      <div class="map-stat-icon" style="background:rgba(34,197,94,0.12)">
        <i class="bi bi-check-circle" style="color:#22c55e"></i>
      </div>
      <div>
        <p class="map-stat-val">{{ stats.open }}</p>
        <p class="map-stat-lbl">Open Offices</p>
      </div>
    </div>
    <div class="map-stat-card">
      <div class="map-stat-icon" style="background:rgba(245,158,11,0.12)">
        <i class="bi bi-clock-history" style="color:#f59e0b"></i>
      </div>
      <div>
        <p class="map-stat-val">{{ stats.comingSoon }}</p>
        <p class="map-stat-lbl">Coming Soon</p>
      </div>
    </div>
    <div class="map-stat-card">
      <div class="map-stat-icon" style="background:rgba(6,182,212,0.12)">
        <i class="bi bi-people" style="color:#06b6d4"></i>
      </div>
      <div>
        <p class="map-stat-val">{{ stats.employees }}</p>
        <p class="map-stat-lbl">Total Employees</p>
      </div>
    </div>
    <div class="map-stat-card">
      <div class="map-stat-icon" style="background:rgba(139,92,246,0.12)">
        <i class="bi bi-globe" style="color:#8b5cf6"></i>
      </div>
      <div>
        <p class="map-stat-val">{{ stats.countries }}</p>
        <p class="map-stat-lbl">Countries</p>
      </div>
    </div>
  </div>

  <!-- Main Layout -->
  <div class="map-main">

    <!-- Sidebar -->
    <div class="map-sidebar">

      <!-- Filters -->
      <div class="map-filter-wrap">
        <p class="map-sidebar-label">Filter by Type</p>
        <div class="map-filters">
          <button class="map-filter-btn" [class.map-filter-active]="activeFilter() === 'all'" (click)="setFilter('all')">All</button>
          <button class="map-filter-btn" [class.map-filter-active]="activeFilter() === 'headquarters'" (click)="setFilter('headquarters')">HQ</button>
          <button class="map-filter-btn" [class.map-filter-active]="activeFilter() === 'branch'" (click)="setFilter('branch')">Branches</button>
          <button class="map-filter-btn" [class.map-filter-active]="activeFilter() === 'warehouse'" (click)="setFilter('warehouse')">Warehouses</button>
          <button class="map-filter-btn" [class.map-filter-active]="activeFilter() === 'service'" (click)="setFilter('service')">Service</button>
        </div>
      </div>

      <!-- Legend -->
      <div class="map-legend">
        <p class="map-sidebar-label">Legend</p>
        <div class="map-legend-items">
          <div class="map-legend-item">
            <div class="map-legend-dot" style="background:#4F6EF7"></div>
            <span>Headquarters</span>
          </div>
          <div class="map-legend-item">
            <div class="map-legend-dot" style="background:#22c55e"></div>
            <span>Branch Office</span>
          </div>
          <div class="map-legend-item">
            <div class="map-legend-dot" style="background:#f59e0b"></div>
            <span>Warehouse</span>
          </div>
          <div class="map-legend-item">
            <div class="map-legend-dot" style="background:#06b6d4"></div>
            <span>Service Center</span>
          </div>
        </div>
      </div>

      <!-- Branch List -->
      <div class="map-branch-list">
        <p class="map-sidebar-label">{{ filteredBranches.length }} Locations</p>
        <div class="map-branches">
          @for (branch of filteredBranches; track branch.id) {
            <button
              class="map-branch-item"
              [class.map-branch-active]="selectedBranch()?.id === branch.id"
              (click)="focusBranch(branch)">
              <div class="map-branch-icon" [style.background]="getTypeColor(branch.type) + '20'">
                <i [class]="getTypeIcon(branch.type)" [style.color]="getTypeColor(branch.type)"></i>
              </div>
              <div class="map-branch-info">
                <p class="map-branch-name">{{ branch.name }}</p>
                <p class="map-branch-location">{{ branch.city }}, {{ branch.country }}</p>
              </div>
              <span [class]="getStatusClass(branch.status)">
                {{ branch.status === 'coming-soon' ? 'Soon' : branch.status }}
              </span>
            </button>
          }
        </div>
      </div>

    </div>

    <!-- Map Container -->
    <div class="map-container-wrap">
      <div id="map" class="map-container"></div>

      <!-- Selected Branch Card -->
      @if (selectedBranch()) {
        <div class="map-detail-card">
          <div class="map-detail-header">
            <div class="map-detail-icon" [style.background]="getTypeColor(selectedBranch()!.type) + '20'">
              <i [class]="getTypeIcon(selectedBranch()!.type)" [style.color]="getTypeColor(selectedBranch()!.type)"></i>
            </div>
            <div class="map-detail-title">
              <p class="map-detail-name">{{ selectedBranch()!.name }}</p>
              <p class="map-detail-type">{{ selectedBranch()!.type | titlecase }}</p>
            </div>
            <button class="map-detail-close" (click)="selectedBranch.set(null)">
              <i class="bi bi-x"></i>
            </button>
          </div>
          <div class="map-detail-body">
            <div class="map-detail-row">
              <i class="bi bi-geo-alt"></i>
              <span>{{ selectedBranch()!.address }}, {{ selectedBranch()!.city }}</span>
            </div>
            <div class="map-detail-row">
              <i class="bi bi-globe"></i>
              <span>{{ selectedBranch()!.country }}</span>
            </div>
            <div class="map-detail-row">
              <i class="bi bi-telephone"></i>
              <span>{{ selectedBranch()!.phone }}</span>
            </div>
            <div class="map-detail-row">
              <i class="bi bi-envelope"></i>
              <span>{{ selectedBranch()!.email }}</span>
            </div>
            <div class="map-detail-row">
              <i class="bi bi-people"></i>
              <span>{{ selectedBranch()!.employees }} employees</span>
            </div>
          </div>
          <div class="map-detail-footer">
            <span [class]="getStatusClass(selectedBranch()!.status)">
              {{ selectedBranch()!.status | titlecase }}
            </span>
          </div>
        </div>
      }

    </div>

  </div>

</div>